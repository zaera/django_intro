{# Load the tag library #}
{% load bootstrap5 %}
{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}
<!DOCTYPE html>
{% load static %}
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Bank List</title>
      <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
      <!-- Font Awesome -->
      <link
         href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
         rel="stylesheet"
         />
      <!-- Google Fonts -->
      <link
         href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700&display=swap"
         rel="stylesheet"
         />
   </head>
   <style>
      body {
      min-height: 81.4vh;
      background: linear-gradient(0deg, #fff, 50%, rgb(210, 231, 252));
      font-family: 'Quicksand', sans-serif;
      font-weight: bold;
      background-repeat: no-repeat;
      overflow-x: hidden;
      }
      table tr td, table tr th{
      background-color: rgba(255,255,255, 1) !important;
      text-align: center;
      margin-top: auto;
      margin-bottom: auto;
      }
      table{
      box-shadow: 0px 0px 1px 0px #6c757d;
      }
      .pic{
      border-radius: 50%;
      }
      .errorlist{
      visibility: hidden;
      }
      .table {
      table-layout: fixed;
      width:75vw;
      }
      .contact{
      position: fixed; bottom: 30px; right: 40px;
      }
      a { display: block; }
   </style>
   <body>
      <script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
      <script src="{% static 'js/bootstrap.min.js' %}"></script>
      <script src="{% static 'js/jquery.bootstrap.modal.forms.js' %}"></script>
      <nav class="navbar navbar-dark bg-primary fixed-top">
         <a class="navbar-brand"  href="#">  <img src="{% static 'dollar.png' %}" width="20" height="30" alt=""> Currency App</a>
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
         </button>
         <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav mr-auto">
               <li class="nav-item ">
                  <a class="nav-link" href="/">Home</a>
               </li>
               <li class="nav-item active">
                  <a class="nav-link" href="/currency/bank/list/">Bank list</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="/currency/rate/list/">Rate list</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="/currency/сontact_us/list/">Messages</a>
               </li>
            </ul>
         </div>
      </nav>
      <br>
      <br>
      <br>
      <div class="row justify-content-center">
         <div class="col-auto">
            <table class="table">
               <thead>
                  <tr>
                     <th scope="col"></th>
                     <th scope="col">Bank</th>
                     <th scope="col">Link</th>
                     <th scope="col"></th>
                  </tr>
               </thead>
               <tbody>
                  {% for ls_element in ls %}
                  <tr>
                     <td class="text-truncate">
                        {% if ls_element.name == "Vkurse" %}
                        <img class="pic" width="50" src="{% static 'vkurse.jpg' %}">
                        {% elif ls_element.name == "Privatbank" %}
                        <img class="pic" width="50" src="{% static 'privatbank.jpg' %}">
                        {% elif ls_element.name == "Monobank" %}
                        <img class="pic" width="50" src="{% static 'monobank.png' %}">
                        {% elif ls_element.name == "Alphabank" %}
                        <img class="pic" width="50" src="{% static 'alpha.png' %}">
                        {% elif ls_element.name == "Raiffeisenbank" %}
                        <img class="pic" width="50" src="{% static 'reiff.png' %}">
                        {% else %}
                        <img class="pic" width="50" src="{% static 'no_image.png' %}">
                        {% endif %}
                     </td>
                     <td class="text-truncate align-middle">
                        {{ ls_element.name }}
                     </td>
                     <td class="text-truncate align-middle">
                        <a href="{{ls_element.url}}" target="blank">{{ls_element.url}}</a>
                     </td>
                     <td class="align-middle">
                        <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#Modal" data-id="{{ls_element.id}}" data-action="view"><i class="fas fa-eye"></i></button>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#Modal" data-id="{{ls_element.id}}" data-action="update"><i class="fas fa-pencil-alt"></i></button>
                        <button type="button" class="btn btn-danger" onclick="del({{ls_element.id}})" data-id="{{ls_element.id}}" data-action="delete"><i class="fas fa-trash-alt"></i></button>
                     </td>
                  </tr>
                  {% endfor%}
               </tbody>
         </div>
      </div>
      </table>
      <a class="contact"> <button type="button" class="btn btn-success" data-toggle="modal" data-target="#Modal" data-id="" data-action="create"><i class="fas fa-plus-circle"></i></button></a>
      <br>
      <br>
      <span class="glyphicon glyphicon-name"></span>
      <!-- Modal -->
      <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
         <div class="modal-dialog" role="document">
            <div class="modal-content">
               <div class="modal-header">
                  <h5 class="modal-title" id="ModalLabel"></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                  </button>
               </div>
               <div class="modal-body" id="modalbody">
               </div>
            </div>
         </div>
      </div>
   </body>
</html>
<script type="text/javascript">
   let ids = []
   let names = []
   let urls=[]
       {% for ls_element in ls %}
   ids.push('{{ls_element.id}}')
   names.push('{{ls_element.name}}')
   urls.push('{{ls_element.url}}')
     {% endfor%}

   $('.modal').on('shown.bs.modal', function (e) {
   var action = $(e.relatedTarget).data('action');
   if (action == 'view') {
     document.getElementById('ModalLabel').innerHTML = 'View'
   var id = $(e.relatedTarget).data('id');
     for (var i=0; i<ids.length; i++) {
       if (ids[i] == id) {
         id = i
       }
     }
     $( "#modalbody" ).append('<h5 class="card-title">'+names[id]+'</h5>' +
                              '<p class="card-text"></p>' +
                              '<a href="'+urls[id]+'" class="card-link text-truncate">'+ urls[id]+'</a>' +
                              '<div class="modal-footer d-block">' +
                              '<button type="button" class="btn btn-secondary float-start" data-dismiss="modal">Close</button>'+
                              '</div>');
   }
   else if (action == 'update') {
     document.getElementById('ModalLabel').innerHTML = 'Update'
         var id = $(e.relatedTarget).data('id');
     var original_id = id
     for (var i=0; i<ids.length; i++) {
       if (ids[i] == id) {
         id = i
       }
     }
      $('#modalbody').append('<form id="form_upd" onsubmit="return update()">' +
                    '<div class="mb-3">' +
                    '<label id="data_id">'+original_id+'</label><p>' +
                    '<label class="form-label">Bank Name</label>' +
                    '<input type="text" maxlength="255" class="form-control" id="bname" name="bname" required value="'+names[id]+'"/>' +
                    '</div>' +
                    '<div class="mb-3">' +
                    '<label class="form-label">Link</label>' +
                    '<input type="text" maxlength="255" class="form-control" id="blink" name="subject" required value="'+urls[id]+'"/>' +
                    '</div>' +
                    '<div class="modal-footer d-block">' +
                    '<button type="submit" class="btn btn-warning float-end">Update</button>' +
                    '<button type="button" class="btn btn-secondary float-start" data-dismiss="modal">Close</button>'+
                    '</div>' +
                    '</form>');
   }
   else if (action == 'create') {
     document.getElementById('ModalLabel').innerHTML = 'Add new'
     $('#modalbody').append('<form id="form" method="post"><div class="mb-3">' +
                            `{% csrf_token %}{{form.as_p}}` +
                           '</div><div class="modal-footer d-block"><button type="submit" class="btn btn-warning float-end">Add</button> ' +
                           '<button type="button" class="btn btn-secondary float-start" data-dismiss="modal">Close</button></div></form>');
     document.getElementById("id_name").classList.add("form-control");
     document.getElementById("id_url").classList.add("form-control");
   }
   })
   function del(val){
     $.ajax({
         url: '../' + 'delete_single' + '/' + val + '/',
         success: function(data){
            window.location.reload();
         },
   })
   }
   function update(){
      var id = document.getElementById('data_id').innerHTML;
      var name = document.getElementById('bname').value;
      var link = document.getElementById('blink').value;
      link=encodeURIComponent(link)
      $.ajax({
         url: '../' + 'edit' + '/' + id + '/'+ name + '/'+ encodeURIComponent(link) + '/',
         success: function(data){
         }
   })
      setTimeout(function() {   document.location.reload(); }, 10);
      window.location.reload();
   }
   $(".modal").on("hidden.bs.modal", function(){
    $(".modal-body").html("");
    document.getElementById('ModalLabel').innerHTML = ''
   })
</script>