{# Load the tag library #}
{% load bootstrap5 %}
{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}
<!DOCTYPE html>
{% load static %}
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Messages List</title>
      <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
      <!-- Font Awesome -->
      <link
         href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
         rel="stylesheet"
         />
      <!-- Google Fonts -->
      <link
         href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700&display=swap"
         rel="stylesheet"
         />
   </head>
   <style>
      body {
      min-height: 81.4vh;
      background: linear-gradient(0deg, #fff, 50%, rgb(210, 231, 252));
      font-family: 'Quicksand', sans-serif;
      font-weight: bold;
      background-repeat: no-repeat;
      overflow-x: hidden;
      }
      table tr td, table tr th{
      background-color: rgba(255,255,255, 1) !important;
      text-align: center;
      margin-top: auto;
      margin-bottom: auto;
      }
      table{
      box-shadow: 0px 0px 1px 0px #6c757d;
      }
      .pic{
      border-radius: 50%;
      }
      .errorlist{
      visibility: hidden;
      }
      .table {
      table-layout: fixed;
      width:75vw;
      }
   </style>
   <body>
      <script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
      <script src="{% static 'js/bootstrap.min.js' %}"></script>
      <script src="{% static 'js/jquery.bootstrap.modal.forms.js' %}"></script>
      <nav class="navbar navbar-dark bg-primary fixed-top">
         <a class="navbar-brand"  href="#">  <img src="{% static 'dollar.png' %}" width="20" height="30" alt=""> Currency App</a>
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
         </button>
         <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav mr-auto">
               <li class="nav-item ">
                  <a class="nav-link" href="/">Home</a>
               </li>
               <li class="nav-item ">
                  <a class="nav-link" href="/currency/bank/list/">Bank list</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="/currency/rate/list/">Rate list</a>
               </li>
               <li class="nav-item active">
                  <a class="nav-link" href="/currency/сontact_us/list/">Messages</a>
               </li>
            </ul>
         </div>
      </nav>
      <br>
      <br>
      <br>
      <div class="row justify-content-center">
         <div class="col-auto">
            <table class="table">
               <thead>
                  <tr>
                     <th scope="col">Email</th>
                     <th scope="col">Subject</th>
                     <th scope="col">Message</th>
                     <th scope="col"></th>
                  </tr>
               </thead>
               <tbody>
                  {% for data_element in data %}
                  <tr>
                     <td class="text-truncate">
                        {{ data_element.email_from }}
                     </td>
                     <td class="text-truncate align-middle">
                        {{ data_element.subject }}
                     </td>
                     <td class="text-truncate align-middle">
                        {{ data_element.message }}
                     </td>
                     <td class="align-middle">
                        <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#Modal" data-id="{{data_element.id}}" data-action="view"><i class="fas fa-eye"></i></button>
                        <button type="button" class="btn btn-danger" onclick="del({{data_element.id}})" data-id="{{ls_element.id}}" data-action="delete"><i class="fas fa-trash-alt"></i></button>
                     </td>
                  </tr>
                  {% endfor%}
               </tbody>
         </div>
      </div>
      </table>
      <!-- Modal -->
      <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
         <div class="modal-dialog" role="document">
            <div class="modal-content">
               <div class="modal-header">
                  <h5 class="modal-title" id="ModalLabel"></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                  </button>
               </div>
               <div class="modal-body" id="modalbody">
               </div>
            </div>
         </div>
      </div>
   </body>
</html>
<script>
   let ids = []
   let email = []
   let subject = []
   let message=[]
   {% for data_element in data %}
   ids.push('{{data_element.id}}')
   email.push('{{data_element.email_from}}')
   subject.push('{{data_element.subject}}')
   message.push(`{{data_element.message}}`)
   {% endfor%}
   $('.modal').on('shown.bs.modal', function (e) {
   var action = $(e.relatedTarget).data('action');
   if (action == 'view') {
     document.getElementById('ModalLabel').innerHTML = 'View'
   var id = $(e.relatedTarget).data('id');
     for (var i=0; i<ids.length; i++) {
       if (ids[i] == id) {
         id = i
       }
     }
     $( "#modalbody" ).append('<div class="card mb-3" style="max-width: 540px;">\n' +
             '  <div class="card-body">\n' +
             '    <h5 class="card-title">'+email[id]+'</h5>\n' +
             '    <h6 class="card-subtitle mb-2 text-muted">'+ subject[id]+'</h6>\n' +
             '    <p class="card-text">'+ message[id]+'</p>\n' +
             '  </div>\n' +
             '</div>'+
             '<div class="modal-footer d-block">' +
             '<button type="button" class="btn btn-secondary float-start" data-dismiss="modal">Close</button>'+
             '</div>'
     );
   }
   })
   function del(val){
     $.ajax({
         url: '../' + 'delete_single' + '/' + val + '/',
         success: function(data){
            window.location.reload();
         },
   })
   }
      $(".modal").on("hidden.bs.modal", function(){
    $(".modal-body").html("");
   })
</script>